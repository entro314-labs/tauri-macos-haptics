# Tauri macOS Haptics

Modern macOS haptics (Taptic Engineâ„¢ï¸) plugin for Tauri v2 apps.

[![Crates.io](https://img.shields.io/crates/v/tauri-macos-haptics)](https://crates.io/crates/tauri-macos-haptics)
[![npm](https://img.shields.io/npm/v/tauri-macos-haptics-api)](https://www.npmjs.com/package/tauri-macos-haptics-api)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

> Modernized and actively maintained by [Entro314 Labs](https://github.com/entro314-labs). Based on original implementation by [ItsEeleeya](https://github.com/ItsEeleeya).



## Features

- ğŸ¯ **Type-Safe**: Modern `objc2` framework with full type safety
- âš¡ **Latest Tauri**: Built for Tauri 2.9+ with all modern features
- ğŸ“± **Complete API**: All 3 NSHapticFeedbackPattern types supported
- ğŸ¦€ **Modern Rust**: Uses Rust 1.93+ with 2024 edition
- ğŸ“ **Well Documented**: Comprehensive inline documentation and examples
- ğŸ”’ **Robust Error Handling**: Proper error types and handling throughout

## Get the plugin

Using the command line from crates.io:

```bash
cargo add tauri-macos-haptics
```

Or add it manually to `Cargo.toml`:

```toml
[target.'cfg(target_os = "macos")'.dependencies]
tauri-macos-haptics = "2.0"
```

Or get the latest from git:

```toml
[target.'cfg(target_os = "macos")'.dependencies]
tauri-macos-haptics = { git = "https://github.com/entro314-labs/tauri-macos-haptics" }
```

### Get the frontend bindings

```bash
pnpm add tauri-macos-haptics-api
# or
bun add tauri-macos-haptics-api
# or
npm install tauri-macos-haptics-api
# or
yarn add tauri-macos-haptics-api
```

## Usage

### 1. Initialize the plugin

This is required to use the plugin from the frontend.

```rust
fn main() {
  let mut builder = tauri::Builder::default();

  #[cfg(target_os = "macos")]
  {
    // Initialize the haptics plugin
    builder = builder.plugin(tauri_macos_haptics::init());
  }

  builder
    .run(tauri::generate_context!())
    .expect("error while running tauri application");
}
```

### 2. Permissions

Add `"tauri-macos-haptics:default"` to your permissions.<br>
Usually found under `src-tauri/capabilities/*.json`

<a href="/permissions/autogenerated/reference.md">Read more about the specific permissions.</a>

### 3. Perform haptic feedback

#### From Rust:

```rust
use tauri_macos_haptics::haptics::*;

fn provide_feedback() {
  #[cfg(target_os = "macos")]
  {
    // Performs a generic haptic feedback immediately
    HapticFeedbackManager::default_performer()
      .perform(HapticPattern::Generic, None)
      .expect("Failed to perform haptic feedback");

    // Or with specific timing
    HapticFeedbackManager::default_performer()
      .perform(
        HapticPattern::Alignment,
        Some(PerformanceTime::DrawCompleted)
      )
      .expect("Failed to perform haptic feedback");
  }
}
```

#### From the frontend (TypeScript):

```typescript
import {
  isSupported,
  perform,
  HapticFeedbackPattern,
  PerformanceTime,
  HapticError,
} from "tauri-macos-haptics-api";

// Check support first
if (await isSupported()) {
  // Basic usage
  await perform();

  // With specific pattern and timing
  await perform(HapticFeedbackPattern.Alignment, PerformanceTime.Now);

  // With error handling
  try {
    await perform(HapticFeedbackPattern.LevelChange, PerformanceTime.DrawCompleted);
  } catch (error) {
    if (error instanceof HapticError) {
      console.error('Haptic feedback failed:', error.message);
    }
  }
}
```

## Haptic Feedback Patterns

### `Alignment`
Use when the user is dragging an object into alignment with another object:
- Aligning shapes in a drawing application
- Snapping to grid positions
- Reaching minimum/maximum bounds
- Positioning objects at preferred locations

### `LevelChange`
Use when transitioning between discrete levels or states:
- Adjusting volume or brightness in steps
- Switching between preset values
- Moving through a multi-level accelerator
- Designed for multilevel accelerator buttons

### `Generic`
General-purpose haptic feedback when no other pattern applies:
- General confirmation of user actions
- Default feedback for most interactions

## Performance Timing

### `Default`
The system chooses the most appropriate time for feedback based on current conditions.

### `Now`
Provide immediate haptic feedback for instant response to user actions.

### `DrawCompleted`
Provide feedback after the next screen update completes, synchronizing haptic feedback with visual changes.

## Important Usage Guidelines

âš ï¸ **Please note that you should trigger feedback ONLY in response to user-initiated actions.**

Ideally, visual feedback, such as a highlight or appearance of an alignment guide, should accompany the haptic feedback.

> In some cases, the system may override a call to this method. For example, a Force Touch trackpad won't provide haptic feedback if the user isn't touching the trackpad.
>
> Haptic feedback is intended to be provided in response to a user action, such as aligning one object to another. Do not use it to provide feedback for events that are not user initiated. Excessive or unnecessary haptic feedback could be interpreted by the user as a malfunction and could encourage the user to disable haptic feedback entirely.

[Learn more about NSHapticFeedbackManager (Apple's documentation)](https://developer.apple.com/documentation/appkit/nshapticfeedbackmanager)

## System Requirements

- **macOS**: 10.11 (OS X El Capitan) or later
- **Hardware**: Force Touch trackpad or compatible haptic hardware
- **Rust**: 1.93 or later (Rust 2024 edition)
- **Tauri**: 2.9 or later

## What's New in 2.0

### Breaking Changes
- Migrated from legacy `objc`/`cocoa` to modern `objc2` framework
- Updated minimum Rust version to 1.77
- Renamed internal types (with backward-compatible aliases)

### Improvements
- âœ¨ Updated to Tauri 2.9 and latest dependencies
- ğŸ”’ Enhanced type safety with `objc2`
- ğŸ“š Comprehensive inline documentation
- ğŸ¯ Better error handling with `HapticError` type
- âš¡ Improved performance and memory safety
- ğŸ§ª Better TypeScript types and JSDoc comments

## Development

### Building the plugin

```bash
cargo build
```

### Building the TypeScript bindings

```bash
pnpm install
pnpm build
```

### Running the example

```bash
pnpm run-example
```

## Contributing

Any contributions are welcomed! Feel free to submit issues or pull requests.

## License

MIT License - see [LICENSE](LICENSE) for details.
